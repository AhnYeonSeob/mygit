<%@ page language="java" contentType="text/html; charset=UTF-8"
	pageEncoding="UTF-8"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c"%>
<%@ taglib uri="http://www.springframework.org/security/tags" prefix="security"%>

<!-- postscript.jsp 에서 이미 적용중 -->
<!-- <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script> -->


<!-- 부트스트랩 5 -->
<!-- SweetAlert2 CSS -->
<link
	href="https://cdn.jsdelivr.net/npm/sweetalert2@11.7.3/dist/sweetalert2.min.css"
	rel="stylesheet">
<!-- Bootstrap 5 CSS -->
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css"
	rel="stylesheet">


<style>
.accordion-item {
	transition: max-height 0.5s ease-in-out;
	overflow: hidden;
}

.accordion-button.collapsed {
	background-color: #f1f1f1;
	transition: background-color 0.3s ease;
}

.accordion-button:not(.collapsed) {
	background-color: #dcdcdc;
}

.accordion-collapse.collapse {
	max-height: 0;
	transition: max-height 0.5s ease-out;
}

/* 적당한 최대 높이 설정 */
.accordion-collapse.show {
	max-height: 500px;
}

/* 배경색 효과 */
.accordion-button {
	background-color: #f8f9fa;
	border: 1px solid #ddd;
}

.accordion-button:hover {
	background-color: #e9ecef;
}
.left {
    max-height: 600px !important;  /* 중요도 높이기 */
    overflow-y: auto !important;
    padding-right: 15px !important;
}
.right {
    max-height: 600px !important;  /* 중요도 높이기 */
    overflow-y: auto !important;
    padding-right: 15px !important;
}
/* 공통 버튼 스타일 */
.attendance-btn {
    padding: 6px 12px;   /* 패딩을 더 줄여서 버튼 크기 축소 */
    font-size: 12px;      /* 폰트 크기를 더 줄여서 텍스트 크기 조정 */
    font-weight: bold;
    color: white;
    border: none;
    border-radius: 25px;  /* 둥근 모서리 */
    cursor: pointer;
    transition: all 0.3s ease;
    margin: 5px;
    outline: none;
    background-color: #ccc; /* 기본 버튼은 은색 */
}

/* 호버 효과 */
.attendance-btn:hover {
    transform: scale(1.05); /* 호버시 버튼 크기 확대 */
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2); /* 호버시 그림자 효과 */
}

/* 선택된 버튼 스타일 */
.attendance-btn.selected {
    transform: scale(1.1); /* 선택된 버튼 크기 확대 */
    box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2); /* 선택된 버튼에 그림자 효과 추가 */
    font-weight: 900;
}

/* 출석 버튼 (파랑) - 선택된 상태일 때만 반영 */
.attendance-btn-blue.selected {
    background: linear-gradient(45deg, #2196F3, #1976D2);
}

.attendance-btn-blue:hover {
    background: linear-gradient(45deg, #1976D2, #2196F3); /* 호버시 그라디언트 색상 반전 */
}

/* 지각 버튼 (초록) - 선택된 상태일 때만 반영 */
.attendance-btn-green.selected {
    background: linear-gradient(45deg, #4CAF50, #388E3C);
}

.attendance-btn-green:hover {
    background: linear-gradient(45deg, #388E3C, #4CAF50); /* 호버시 그라디언트 색상 반전 */
}

/* 결석 버튼 (노랑) - 선택된 상태일 때만 반영 */
.attendance-btn-yellow.selected {
    background: linear-gradient(45deg, #FFEB3B, #FBC02D);
}

.attendance-btn-yellow:hover {
    background: linear-gradient(45deg, #FBC02D, #FFEB3B); /* 호버시 그라디언트 색상 반전 */
}

/* 조퇴 버튼 (빨강) - 선택된 상태일 때만 반영 */
.attendance-btn-red.selected {
    background: linear-gradient(45deg, #F44336, #D32F2F);
}

.attendance-btn-red:hover {
    background: linear-gradient(45deg, #D32F2F, #F44336); /* 호버시 그라디언트 색상 반전 */
}
/* 테이블 셀에 일정한 크기를 지정하는 스타일 */
.cell-style {
    height: 40px;    /* 최소 높이 */
}
</style>


<input type="hidden" value="${pageContext.request.contextPath}" id="contextPath">

<div class="container">
    <!-- 왼쪽: 강의 정보 (주차별 강의 정보) -->
    <div class="left" style="width: 28%; float: left; box-sizing: border-box;">
        <div class="accordion" id="accordionExample">
            <c:forEach items="${selectOrderLectureDataList}" var="week">
                <div class="accordion-item">
                    <h2 class="accordion-header" id="heading-${week.weekCd}">
                        <div class="accordion-button" data-bs-toggle="collapse"
                             data-bs-target="#collapse-${week.weekCd}" aria-expanded="false"
                             aria-controls="collapse-${week.weekCd}">
                            ${week.commonCodeVO.cocoStts} 강의
                        </div>
                    </h2>
                    <div id="collapse-${week.weekCd}" class="accordion-collapse collapse"
                         aria-labelledby="heading-${week.weekCd}" data-bs-parent="#accordionExample">
                        <div class="accordion-body custom-scroll">
                            <c:forEach items="${week.orderLectureDataList}" var="order">
							    <strong>일자:</strong>${order.sectDt} <br>
							    <strong>강의차수:</strong> ${order.lectOrder}회차 <br>
							    <strong>교시:</strong> ${order.timeCommonCodeVO.cocoStts} <br>
								<button class="fetch-attendance-btn"
								        data-week-cd="${week.weekCd}"  
								        data-lect-order="${order.lectOrder}"
								     data-lect-no="${order.lectNo}"
								     data-sect-dt="${order.sectDt}"
						                data-lect-order="${order.lectOrder}"
						                data-coco-stts="${order.timeCommonCodeVO.cocoStts}">조회
								    <input type="hidden" name="lectNo" id="lectNo" value="${order.lectNo}" />
								</button>
							    <hr>
							</c:forEach>
                        </div>
                    </div>
                </div>
            </c:forEach>
        </div>
    </div>

	

    <!-- 오른쪽: 출석 리스트 (학생별 출석 정보) -->
    <div class="right" style="width: 70%; float: right; box-sizing: border-box;">
    	<div class="attendance-buttons" style="display: flex; justify-content: flex-end; gap: 10px; margin-bottom: 20px;">
		</div>
			<table class="table table-primary align-middle table-bordered">
			    <thead>
			        <tr>
			            <th>일자</th>
			            <th>강의차수</th>
			            <th>교시</th>
			        </tr>
			    </thead>
			    <tbody>
			        <tr id="targetRow">
			            <td id="sectDtCell" class="cell-style"> </td>
			            <td id="lectOrderCell" class="cell-style"> </td>
			            <td id="cocoSttsCell" class="cell-style"> </td>
			        </tr>
			    </tbody>
			</table>
					
        <table class="table table-bordered align-middle table-bordered">
            <thead>
                <tr>
                    <th>학번</th>
                    <th>학생이름</th>
<!--                     <th>출석일자</th> -->
<!--                     <th>교시</th>  -->
                    <th>출결상태</th>
<!--                     <th>공결 신청</th> -->
                    <!-- <th>시청시간</th> -->
                </tr>
            </thead>
            <tbody id="attendanceTableBody" style="display: none;">
			    <c:forEach items="${selectAttendanceList}" var="attendance">
			        <tr class="attendanceRow" data-week-cd="${attendance.weekCd}" data-lect-order="${attendance.lectOrder}" data-lect-no="${attendance.lectNo}">
			            <td>${attendance.studentVO.id}</td>
			            <td>${attendance.studentVO.nm}</td>
			            <td>
			                <button type="button" class="attendance-btn attendance-btn-blue ${attendance.commonCodeVO.cocoStts == '출석' ? 'selected' : ''}"
			                        data-status="출석" data-student-id="${attendance.studentVO.id}" data-week-cd="${attendance.weekCd}"
			                        data-lect-order="${attendance.lectOrder}" data-lect-no="${attendance.lectNo}"
			                        onclick="setAttendanceStatus(this, '${attendance.studentVO.id}', '${attendance.weekCd}', '${attendance.lectOrder}', '${attendance.lectNo}')">출석
			                </button>
			                <button type="button" class="attendance-btn attendance-btn-green ${attendance.commonCodeVO.cocoStts == '지각' ? 'selected' : ''}"
			                        data-status="지각" data-student-id="${attendance.studentVO.id}" data-week-cd="${attendance.weekCd}"
			                        data-lect-order="${attendance.lectOrder}" data-lect-no="${attendance.lectNo}"
			                        onclick="setAttendanceStatus(this, '${attendance.studentVO.id}', '${attendance.weekCd}', '${attendance.lectOrder}', '${attendance.lectNo}')">지각
			                </button>
			                <button type="button" class="attendance-btn attendance-btn-yellow ${attendance.commonCodeVO.cocoStts == '결석' ? 'selected' : ''}"
			                        data-status="결석" data-student-id="${attendance.studentVO.id}" data-week-cd="${attendance.weekCd}"
			                        data-lect-order="${attendance.lectOrder}" data-lect-no="${attendance.lectNo}"
			                        onclick="setAttendanceStatus(this, '${attendance.studentVO.id}', '${attendance.weekCd}', '${attendance.lectOrder}', '${attendance.lectNo}')">결석
			                </button>
			                <button type="button" class="attendance-btn attendance-btn-red ${attendance.commonCodeVO.cocoStts == '조퇴' ? 'selected' : ''}"
			                        data-status="조퇴" data-student-id="${attendance.studentVO.id}" data-week-cd="${attendance.weekCd}"
			                        data-lect-order="${attendance.lectOrder}" data-lect-no="${attendance.lectNo}"
			                        onclick="setAttendanceStatus(this, '${attendance.studentVO.id}', '${attendance.weekCd}', '${attendance.lectOrder}', '${attendance.lectNo}')">조퇴
			                </button>
			            </td>
			        </tr>
			    </c:forEach>
			</tbody>
        </table>
    </div>
    <security:authorize access="hasRole('PROFESSOR')">
    <div class="right mb-3" style="width: 64%; float: right; box-sizing: border-box;">
		<button type="button" class="btn btn-success float-end me-3" id="saveAttendanceButton">저장</button>
    	<button type="button" class="btn btn-primary float-end me-3" id="markAllPresentButton">일괄 출석</button>
    </div>
    </security:authorize>
</div>





<script src="${pageContext.request.contextPath }/resources/js/attendance/attendance.js"></script>
<%-- <script src="${pageContext.request.contextPath }/resources/js/attendance/attendancedatatable.js"></script> --%>






