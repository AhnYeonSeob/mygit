<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c"%>
<%@ taglib uri="http://www.springframework.org/tags/form" prefix="form"%>
<%@ taglib uri="http://www.springframework.org/security/tags" prefix="security"%>

<div class="input-group mb-3 float-end search-area" data-pg-target="#searchform" data-pg-fn-name="fnPaging" style="width: 350px;">
	<form:select path="condition.searchType" cssClass="form-select">
		<form:option value="" label="전체"/>
		<form:option value="id" label="학번"/>
		<form:option value="name" label="작성자"/>
		<form:option value="content" label="내용"/>
	</form:select>
	<form:input path="condition.searchWord" cssClass="form-control" style="width: 150px;"/>
	<button id="search-btn" class="btn btn-primary">검색</button>
</div>

<style>
  /* 작은 텍스트 설정 */
  .small-text {
    font-size: 0.8rem; /* 더 작은 크기 */
    color: #6c757d; /* 약간 회색으로 색상도 조정 */
  }

  /* 큰 텍스트 설정 (사유는 크게 표시) */
  .large-text {
    font-size: 1rem; /* 기본 텍스트보다 조금 큰 크기 */
    display: block; /* 사유가 여러 줄로 보이도록 */
    white-space: pre-wrap; /* 내용이 길어질 경우 줄 바꿈을 허용 */
    word-wrap: break-word; /* 긴 단어를 잘라서 줄 바꿈 */
    color: #000; /* 글씨 색상은 검정색 */
  }

  /* 테이블 스타일 */
  .table {
    width: 100%;
    margin-bottom: 1rem;
    color: #212529;
  }

  .table td {
    padding: 0.3rem; /* 각 셀의 padding을 더 작게 설정 */
  }
</style>


<input type="hidden" value="${pageContext.request.contextPath}" id="contextPath">


<!-- 페이징 처리랑 연결해서 출력되는 부분의 페이지를 넘겨줘야하는데 시간이 오래걸릴거같아서 보류 -->
<!-- <select class="form-select form-select-sm ms-auto" style="width: 150px;" id="statusFilter" aria-label="Default select example"> -->
<!--   <option selected>전체</option> "선택해주세요." -> "전체조회", disabled 제거 -->
<!--   <option value="대기">대기</option> -->
<!--   <option value="승인">승인</option> -->
<!--   <option value="반려">반려</option> -->
<%--   <security:authorize access="hasRole('PROFESSOR')"> --%>
<!--   	<option value="삭제">삭제</option> -->
<%--   </security:authorize> --%>
<!-- </select> -->

<div>
  <table class="table table-primary align-middle table-bordered" id="absenceTable">
    <thead>
      <tr>
     	<th>접수번호</th>
        <th>강의차수</th>
        <th>일자</th>
        <th>교시</th>
        <th>학번</th>
        <th>이름</th>
        <th>출결상태</th>
        <th>공결사유</th>
        <th>서류접수상태</th>
        <th>처리방법</th>
      </tr>
    </thead>
    <tbody>
    <c:forEach items="${selectAbsenceCertificateReceiptList}" var="absence">
      <tr class="absenceRow" data-absence-status="${absence.PRST}">
        <td>${absence.absenceCd }</td>
        <td>${absence.lectOrder} 회차</td>
        <td>${absence.orderVO.sectDt}</td>
        <td>${absence.TEIN}</td>
        <td>${absence.stuId}</td>
        <td>${absence.studentVO.nm}</td>
        <td>${absence.ATST}</td>
        <td class="absenceResn">${absence.absenceResn}</td>
        <td>${absence.PRST}</td>
        <td>
          <!-- 테이블의 버튼 -->
          <!-- 학생용 수정 버튼 -->
          	<security:authorize access="!hasRole('PROFESSOR')">
          		<button type="button" data-bs-toggle="modal" data-bs-target="#staticBackdropEdit"
			        data-absenceCd="${absence.absenceCd}"
			        data-lectOrder="${absence.lectOrder}"
			        data-studentName="${absence.studentVO.nm}"
			        data-studentId="${absence.stuId}"
			        data-absenceReason="${absence.absenceResn}"
			        data-absenceStatus="${absence.PRST}"
			        data-weekCd="${absence.weekCd}"
			        data-lectNo="${absence.lectNo}">
			        수정
			    </button>
			    <button type="button" class="absenceDeleteBtn"
				    data-absenceCd="${absence.absenceCd}" 
				    data-cocoCd="${absence.cocoCd}"
				    data-lectNo="${absence.lectNo}">
					삭제
				</button>
          	</security:authorize>
          <!-- 교수용 승인, 반려 버튼 -->
          	<security:authorize access="hasRole('PROFESSOR')">
				<button type="button" data-bs-toggle="modal" data-bs-target="#staticBackdrop"
				    data-absenceCd="${absence.absenceCd}"
				    data-lectOrder="${absence.lectOrder}"
				    data-studentName="${absence.studentVO.nm}"
				    data-studentId="${absence.stuId}"
				    data-absenceReason="${absence.absenceResn}"
				    data-absenceStatus="${absence.PRST}"
				    data-weekCd="${absence.weekCd}"
				    data-lectNo="${absence.lectNo}">
				    처리
				</button>
			</security:authorize>
        </td>
      </tr>
    </c:forEach>
  </tbody>
  
  
  
  <tfoot>
		<tr>
			<td colspan="10">
				<div class="d-flex justify-content-between align-items-center" style="position: relative; z-index: 0">
					<div class="mx-auto">
						${pagingHTML}
					</div>
<%-- 					<security:authorize access="hasRole('STUDENT')"> --%>
<!-- 						<div> -->
<%-- 							<a class="btn btn-primary" style="position: absolute; right: 0px; top: 0px;" href='<c:url value="/lecture/${lecture.lectNo }/inquiry/new"/>'>등록</a> --%>
<!-- 						</div> -->
<%-- 					</security:authorize> --%>
				</div>			
			</td>
		</tr>
	</tfoot>
  
  
  </table>
</div>


<!-- 수정 모달 (학생용) -->
<div class="modal fade" id="staticBackdropEdit" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabelEdit" aria-hidden="true">
    <div class="modal-dialog" style="max-width: 80%; width: 80%;">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="staticBackdropLabelEdit">수정</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <table class="table">
                    <tbody>
		              <tr>
		                <td><strong>강의 차수:</strong></td>
		                <td id="lectOrder" class="small-text"></td>
		                <td><strong>학생명:</strong></td>
		                <td id="studentName" class="small-text"></td>
		              </tr>
		              <tr>
		                <td><strong>학번:</strong></td>
		                <td id="studentId" class="small-text"></td>
		                <td><strong>상태:</strong></td>
		                <td id="absenceStatus" class="small-text"></td>
		              </tr>
		            </tbody>
                </table>
<!--                 <img src="https://plus.unsplash.com/premium_photo-1675553988173-a5249b5815fe?q=80&w=1064&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D"  -->
<!-- 		        	alt="임시 이미지"  -->
<!-- 		        	class="img-fluid mb-3"  -->
<!-- 		        	style="max-width: 200px;  -->
<!-- 		        	height: auto;"> -->
                <p><strong>사유:</strong></p>
                <div class="mb-3">
                    <textarea class="form-control" id="editAbsenceReason" rows="3"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" id="saveEditButton">수정</button>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">취소</button>
            </div>
        </div>
    </div>
</div>


<!-- 승인 처리 (교수용) -->
<div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
  <div class="modal-dialog" style="max-width: 80%; width: 80%;">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="staticBackdropLabel">승인 처리</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <table class="table">
          <tbody>
            <tr>
              <td><strong>강의 차수:</strong></td>
              <td id="lectOrder2" class="small-text"></td>
              <td><strong>학생명:</strong></td>
              <td id="studentName2" class="small-text"></td>
            </tr>
            <tr>
              <td><strong>학번:</strong></td>
              <td id="studentId2" class="small-text"></td>
              <td><strong>상태:</strong></td>
              <td id="absenceStatus2" class="small-text"></td>
            </tr>
          </tbody>
        </table>
<!--         <img src="https://plus.unsplash.com/premium_photo-1675553988173-a5249b5815fe?q=80&w=1064&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D"  -->
<!--         	 alt="임시 이미지"  -->
<!--         	 class="img-fluid mb-3"  -->
<!--         	 style="max-width: 200px;  -->
<!--         	 height: auto;"> -->
        <p><strong>사유:</strong> <span id="absenceReason2" class="large-text"></span></p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary" id="rejectButton">반려</button>
        <button type="button" class="btn btn-primary" id="approveButton">승인</button>
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">취소</button>
      </div>
    </div>
  </div>
</div>







<form:form id="searchform" method="get" modelAttribute="condition" style="display: none;">
	<form:input path="searchType"/>
	<form:input path="searchWord"/>
	<input type="hidden" name="page" />
</form:form>
<!-- <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.min.js"></script> -->
<script src="${pageContext.request.contextPath }/resources/js/utils/paging.js"></script>
<script src="${pageContext.request.contextPath }/resources/js/absenceCertificateReceipt/absencecertificatereceipt.js"></script>
