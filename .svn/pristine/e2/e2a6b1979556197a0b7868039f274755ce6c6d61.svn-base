<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/functions" prefix="fn" %>
<style>
	.btn-area{
		text-align:right;
	}
</style>
<h2>자기소개서 첨삭</h2>

<form action="<c:url value='/introduce/edit' />" method="post">
    <table class="table table-bordered">
<%--     	<colgroup> --%>
<%--     		<col style="width:20%;"> --%>
<%--     		<col style="width:40%;"> --%>
<%--     		<col style="width:40%;"> --%>
<%--     	</colgroup> --%>
        <tr class="text-center">
            <th>항목</th>
            <th>기존 데이터</th>
        </tr>
        <tr>
            <td class="align-middle text-center">지원동기</td>
            <td>${introduce.intQue1}</td>
        </tr>
        <tr>
            <td class="align-middle text-center">입사 후 포부</td>
            <td>${introduce.intQue2}</td>
        </tr>
        <tr>
            <td class="align-middle text-center">성격 및 장단점</td>
            <td>${introduce.intQue3}</td>
        </tr>
        <tr>
        <th>피드백 사항</th>
        	<td>
                <textarea id="intFeed" name="intFeed" rows="5" class="form-control">${introduce.intFeed}</textarea>
            </td>
        </tr>
    </table>

    <input type="hidden" name="stuId" value="${introduce.stuId}" />

    <div class="btn-area">
        <button type="submit" id="saveButton" class="btn btn-primary">수정완료</button>
        <a href="<c:url value='/introduce' />" class="btn btn-secondary">취소</a>
    </div>
</form>
<script>
document.getElementById('saveButton').addEventListener('click', function (e) {
    e.preventDefault(); 

    const stuId = document.querySelector('input[name="stuId"]').value;
    const intFeed = document.getElementById('intFeed').value;

    swal({
        title: "정말로 등록하시겠습니까?",
        text: "작성된 내용이 등록됩니다.",
        icon: "warning",
        buttons: ["취소", "등록"],
        dangerMode: true,
    }).then((btnVal) => {
        if (btnVal) {
            fetch(`/yguniv/introduce/edit/${stuId}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ stuId, intFeed })
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('등록에 실패하였습니다.');
                }
                return response.json();
            })
            .then(data => {
                if (data) {
                    // 수정된 데이터 업데이트
                    document.getElementById('intFeed').value = data.intFeed;

                    swal({
                        title: "등록 완료",
                        text: "피드백 등록 완료되었습니다.",
                        icon: "success",
                    }).then(() => {
                        // 상세보기 페이지로 이동
                        window.location.href = `/yguniv/introduce/detail/${stuId}`;
                    });
                }
            })
            .catch(error => {
                console.error('Error:', error);
                swal({
                    title: "오류 발생",
                    text: "서버와의 통신에 실패하였습니다.",
                    icon: "error",
                });
            });
        }
    });
});

</script>

