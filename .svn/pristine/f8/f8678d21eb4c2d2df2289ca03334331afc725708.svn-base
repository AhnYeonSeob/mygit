<%@ page language="java" contentType="text/html; charset=UTF-8"
	pageEncoding="UTF-8"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c"%>
<%@ taglib uri="http://www.springframework.org/tags/form" prefix="form"%>
<%@ taglib uri="http://www.springframework.org/tags" prefix="spring"%>
<%@taglib uri="http://java.sun.com/jsp/jstl/functions" prefix="fn" %>
<%@ taglib uri="http://www.springframework.org/security/tags" prefix="security"%>


<script>
    // 서버의 컨텍스트 경로를 JavaScript 변수에 설정
    const contextPath = "${pageContext.request.contextPath}/";
</script>
<style>
/* 제목 셀이 최대한 확장되도록 설정 */
td {
    white-space: nowrap; /* 제목 텍스트 줄바꿈 방지 */
}

td[colspan="2"] {
    width: 100%; /* 제목 셀이 가능한 넓게 확장 */
}

button.btn {
    padding: 5px 10px; /* 버튼 크기 조정 */
    font-size: 14px; /* 버튼 텍스트 크기 */
}
</style>
<nav style="--bs-breadcrumb-divider: '>';" aria-label="breadcrumb">
  <ol class="breadcrumb">
    <li class="breadcrumb-item">시스템 공지사항</li>
    <li class="breadcrumb-item active" aria-current="page">상세보기</li>
  </ol>
</nav>
		<div class="fixed-container">
		    <table class="table table-primary">
		        <thead align="center">
		          <tr style="font-size: 20px;">
		    <td colspan="1" height="60px;">게시물 제목</td>
		    <!-- 제목과 버튼을 각각 다른 셀로 분리 -->
		    <td class="bg-light" colspan="4" style="text-align: left;">${systemBoard.snbTtl}</td>
		    <td style="text-align: center;">
		        <!-- 팝업등록 버튼 -->
		        <security:authorize access="hasRole('ADMIN')">
		            <button class="btn btn-primary">팝업등록</button>
		        </security:authorize>
		    </td>
		</tr>

        </thead>
        
        <tbody align="center">
            <tr style="font-size: 20px;">
            	<td colspan="1">작성일시</td>
             	<td class="bg-light">
                    ${fn:split(systemBoard.snbDt, 'T')[0]} ${fn:split(systemBoard.snbDt, 'T')[1]}
                </td>
                <td colspan="1">작성자</td>
                <td class="bg-light">${systemBoard.adminId}</td>
                <td colspan="1">조회수</td>
                <td class="bg-light">${systemBoard.snbCount}</td>
            </tr>
            <tr>
               
            </tr>
           <tr>
			    <td colspan="6" class="bg-light"> <!-- 테두리 제거 -->
			        <!-- 첨부된 이미지 파일을 내용에 추가 -->
			        <c:forEach items="${systemBoard.atchFile.fileDetails}" var="fd">
			            <c:if test="${fn:toLowerCase(fd.fileExtsn) == 'jpg' || 
			                         fn:toLowerCase(fd.fileExtsn) == 'jpeg' || 
			                         fn:toLowerCase(fd.fileExtsn) == 'png' || 
			                         fn:toLowerCase(fd.fileExtsn) == 'gif'}">
			                <div style="margin-top: 10px;">
			                    <img src="<c:url value='/systemBoard/${systemBoard.snbNo}/atch/${fd.atchFileId}/${fd.fileSn}' />" 
			                         alt="${fd.orignlFileNm}" 
			                         style="max-width: 50%; height: auto;" />
			                </div>
			            </c:if>
			        </c:forEach>
			        <pre style="font-size: 20px; margin: 0;">${systemBoard.snbCn}</pre>
			    </td>
			</tr>

            <tr>
                <td colspan="1">첨부파일</td>
                <td colspan="5" class="bg-light">
                    <c:forEach items="${systemBoard.atchFile.fileDetails}" var="fd" varStatus="vs">
                        <c:url value='/systemBoard/${systemBoard.snbNo}/atch/${fd.atchFileId}/${fd.fileSn}' var="downUrl" />
                        <a href="${downUrl}">${fd.orignlFileNm}(${fd.fileFancysize})</a>
                        ${not vs.last ? '|' : ''}
                    </c:forEach>
                    <c:if test="${empty systemBoard.atchFile.fileDetails}">
                        첨부파일없음
                    </c:if>
                </td>
            </tr>
        </tbody>
    </table>
</div>

<div style="display: flex; justify-content: flex-end; gap: 10px;">

    <!-- ADMIN 사용자에게만 표시 -->
    <security:authorize access="hasRole('ADMIN')">
        <a href="<c:url value='/systemBoard/${snbNo}/edit' />" class="btn btn-info">수정</a>
        
        <form action="<c:url value='/systemBoard/delete/${snbNo}' />" method="post" style="display:inline;">
            <button type="submit" class="btn btn-danger">삭제</button>
        </form>
    </security:authorize>
    
    <!-- 모든 사용자에게 표시 -->
    <a href="<c:url value='/systemBoard' />" class="btn btn-primary">목록</a>

</div>

			



<script src="${pageContext.request.contextPath }/resources/js/board/delete.js"></script>
