<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.or.ddit.yguniv.lecture.dao.LectureMaterialsMapper">
	<resultMap type="OrderLectureDataVO" id="orderLectureDataList" autoMapping="true">
		<association property="lectureWeekVO" javaType="LectureWeekVO" autoMapping="true"/>
	</resultMap>
	<!-- 강의 수업 목록 조회 -->
	<select id="selectOrderLectureDataList" resultMap="orderLectureDataList">
		SELECT D.LECT_ORDER, D.WEEK_CD, D.LECT_NO
			, D.SECT_NM, D.SECT_DT, D.SECT_ET, D.SECT_IDNTY
			, W.LEWE_NM
		FROM ORDER_LECTURE_DATA D
		INNER JOIN LECTURE_WEEK W ON(D.WEEK_CD = W.WEEK_CD AND D.LECT_NO = #{lectNo})
	</select>
	<resultMap type="kr.or.ddit.yguniv.vo.OrderLectureDataVO" id="orderLectureDataFile" autoMapping="true">
		<collection property="atchFileDetailList" ofType="AtchFileDetailVO" autoMapping="true"/>
	</resultMap>
	<!-- 강의 상세 조회(강의방 입장) -->
	<select id="selectOrderLectureData" resultMap="orderLectureDataFile">
		SELECT D.LECT_ORDER, D.WEEK_CD, D.LECT_NO
		    , D.SECT_NM, D.SECT_DT, D.SECT_ET, D.SECT_IDNTY
		    , F.FILE_SN, F.ATCH_FILE_ID, F.FILE_STRE_COURS, F.STRE_FILE_NM, F.ORIGNL_FILE_NM
		    , F.FILE_EXTSN, F.FILE_CN, F.FILE_SIZE, F.FILE_FANCYSIZE, F.FILE_MIME, F.FILE_DWNCNT
		FROM ORDER_LECTURE_DATA D
		INNER JOIN ATCH_FILE_DETAIL F ON(D.ATCH_FILE_ID = F.ATCH_FILE_ID AND D.LECT_NO = #{lectNo})
		WHERE D.LECT_ORDER = #{lectOrder}
	</select>
	<!-- 강의 주차 추가 -->
	<insert id="insertLectureWeek">
		INSERT INTO LECTURE_WEEK (
		    WEEK_CD, LECT_NO, LEWE_NM
		) VALUES (
		    #{weekCd}, #{lectNo}, #{leweNm}
		)
	</insert>
	<!-- 강의 주차 수정 -->
	<update id="updateLectureWeek">
		UPDATE LECTURE_WEEK SET
			LEWE_NM = #{leweNm}
		WHERE
		    WEEK_CD = #{weekCd}
		    AND LECT_NO = #{lectNo}
	</update>
	<!-- 강의 주차 삭제 -->
	<delete id="deleteLectureWeek">
		DELETE FROM LECTURE_WEEK
		WHERE
		    WEEK_CD = #{weekCd}
		    AND LECT_NO = #{lectNo}
	</delete>
	<!-- 강의 차시 추가 -->
	<insert id="insertOrderLectureData">
		INSERT INTO ORDER_LECTURE_DATA (
		    LECT_ORDER, WEEK_CD, LECT_NO
		    , SECT_NM, SECT_DT, SECT_ET, SECT_IDNTY, ATCH_FILE_ID
		) VALUES (
		    #{lectOrder}, #{weekCd}, #{lectNo}
		    , #{sectNm}, #{sectDt}, #{sectEt}, #{sectIdnty}, #{atchFileId}
		)
	</insert>
	<!-- 강의 차시 수정 -->
	<update id="updateOrderLectureData">
		UPDATE ORDER_LECTURE_DATA SET
			SECT_NM = #{sectNm}
		    AND SECT_DT = #{sectDt}
		    AND SECT_ET = #{sectEt}
		    AND SECT_IDNTY = #{sectIdnty}
		    AND ATCH_FILE_ID = #{atchFileId}
		WHERE
		    LECT_ORDER = #{lectOrder}
		    AND LECT_NO = #{lectNo}
	</update>
	<!-- 강의 차시 삭제 -->
	<delete id="deleteOrderLectureData">
		DELETE FROM ORDER_LECTURE_DATA
		WHERE
		    WEEK_CD = #{weekCd}
		    AND LECT_NO = #{lectNo}
		<!-- 강의 주차 삭제전 주차에 해당하는 차시 삭제의 경우인지 판단 -->
		<if test="lectOrder neq null">
		    AND LECT_ORDER = #{lectOrder}
		</if>
	</delete>
</mapper>