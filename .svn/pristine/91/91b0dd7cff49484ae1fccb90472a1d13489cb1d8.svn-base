<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper
	namespace="kr.or.ddit.yguniv.noticeboard.dao.NoticeBoardMapper">
	<sql id="columns">
	NTC_CD
	,PRS_ID
	,NTC_YN
	,ATCH_FILE_ID
	,NTC_NM
	,NTC_DESC
	,NTC_DT
	,NTC_ET
	,NTC_INQ_CNT
	</sql>
<!-- 게시글 생성 -->	
<insert id="insertNoticeBoard">
	<selectKey order="BEFORE" resultType="int" keyProperty="ntcCd">
		SELECT SEQ_NOTICEBOARD.NEXTVAL FROM DUAL
	</selectKey>
	INSERT INTO NOTICEBOARD(
	<include refid="columns"/>
	) VALUES(
	 #{ntcCd,jdbcType=NUMERIC}
	, #{prsId,jdbcType=VARCHAR}
	, #{ntcYn,jdbcType=VARCHAR}
	, #{atchFileId,jdbcType=NUMERIC}
	, #{ntcNm,jdbcType=VARCHAR}
	, #{ntcDesc,jdbcType=VARCHAR}
	<if test="ntcDt neq null">
	, #{ntcDt,jdbcType=VARCHAR}
	</if>
	<if test="ntcDt eq null">
	, TO_CHAR(SYSDATE, 'YYYY-MM-DD')
	</if>
	<if test="ntcEt neq null">
	, #{ntcEt,jdbcType=VARCHAR}
	</if>
	<if test="ntcEt eq null">
	, TO_CHAR(SYSDATE, 'YYYY-MM-DD')
	</if>
	, 0
	)
</insert>

<resultMap type="NoticeBoardVO" id="boardMap" autoMapping="true">
	<id property="ntcCd" column="ntcCd" />
	<result property="atchFileId" column="ATCH_FILE_ID" />
	<association property="atchFile" column="ATCH_FILE_ID"
			select="kr.or.ddit.yguniv.atch.dao.AtchFileMapper.selectAtchFileEnable" />
</resultMap>

<select id="selectNoticeBoard" resultMap="boardMap">
	SELECT
	<include refid="columns" />
	FROM NOTICEBOARD
	WHERE NTC_CD = #{ntcCd}
</select>

<update id="incrementCnt">
	UPDATE NOTICEBOARD
	SET
		NTC_INQ_CNT = NTC_INQ_CNT + 1
	WHERE NTC_CD = #{ntcCd}
</update>

<!-- 검색 조건 -->
	<sql id="searchFrag">
		<where>
			<if
				test="@org.apache.commons.lang3.StringUtils@isNotBlank(simpleCondition.searchWord)">
				<choose>
					<when
						test="simpleCondition.searchType eq 'title'">
						INSTR(NTC_NM, #{simpleCondition.searchWord}) > 0
					</when>
					<when
						test="simpleCondition.searchType eq 'writer'">
						INSTR(PRS_ID, #{simpleCondition.searchWord}) > 0
					</when>
					<when
						test="simpleCondition.searchType eq 'content'">
						INSTR(NTC_DESC, #{simpleCondition.searchWord}) > 0
					</when>
					<otherwise>
						INSTR(NTC_NM, #{simpleCondition.searchWord}) > 0 
						OR INSTR(PRS_ID, #{simpleCondition.searchWord}) > 0 
						OR INSTR(NTC_DESC, #{simpleCondition.searchWord}) > 0
					</otherwise>
				</choose>
			</if>
		</where>
	</sql>

<!-- 전체 게시글 수 조회 -->
<select id="selectTotalRecord" resultType="int">
		SELECT COUNT(NTC_CD) FROM NOTICEBOARD
		<include refid="searchFrag" />
</select>

<!-- 페이징처리 글목록조회 -->
<select id="selectNoticeBoardlistPaging" resultType="NoticeBoardVO">
		SELECT B.* 
		FROM 
		( 
			SELECT ROWNUM RNUM, A.* 
			FROM 
			( 
				SELECT
					<include refid="columns" />
				FROM NOTICEBOARD
				<include refid="searchFrag" />
				ORDER BY NTC_CD DESC 
			) A 
		) B
		<![CDATA[
		WHERE RNUM >= #{startRow} AND RNUM <= #{endRow}
		]]>
</select>

<!-- 논페이징 글목록조회 -->
<select id="selectNoticeBoardlist" resultType="NoticeBoardVO">
		SELECT A.*, ROWNUM RNUM 
		FROM 
		( 
			SELECT
				<include refid="columns" />
			FROM NOTICEBOARD ORDER BY NTC_CD DESC 
		) A
</select>

<update id="updateNoticeBoard">
	UPDATE NOTICEBOARD
	SET
		NTC_NM = #{ntcNm,jdbcType=VARCHAR}
		,NTC_DESC = #{ntcDesc,jdbcType=VARCHAR}
		<if test="ntcDt neq null">
		, NTC_DT = #{ntcDt,jdbcType=VARCHAR}
		</if>
		<if test="ntcEt neq null">
		, NTC_ET = #{ntcEt,jdbcType=VARCHAR}
		</if>
		<if test="atchFileId neq null">
				, ATCH_FILE_ID = #{atchFileId,jdbcType=NUMERIC}
		</if>
	WHERE NTC_CD = #{ntcCd}
</update>

<delete id="deleteNoticeBoard">
	DELETE FROM NOTICEBOARD
	WHERE NTC_CD = #{ntcCd}
</delete>


</mapper>