<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c"%>
<%@ taglib uri="http://www.springframework.org/tags/form" prefix="form"%>
<%@ taglib uri="http://www.springframework.org/tags" prefix="spring"%>
<%@ taglib uri="http://www.springframework.org/security/tags" prefix="security"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/fmt" prefix="fmt"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/functions" prefix="fn" %>

<h4>학생증 상세조회</h4>
<input type="hidden" value="${card.stuId}" id="stuId" />
<script>
    const contextPath = "${pageContext.request.contextPath}/";
</script>
 
  <form id="updateStatusForm" action="${pageContext.request.contextPath}/studentCard/updateStatus" method="POST">  
     <table  class="table table-bordered">
        <tbody>
            <tr>
                <td>발급상태</td>
                <td class="status-row" style="display: flex; align-items: center; gap: 10px;">
			        <!-- Hidden Inputs -->
			        <input type="hidden" id="approvalDateInput" name="shapChcDate" value="${ask.shapChcDate}" />
			        <input type="hidden" name="stuId" value="${card.stuId}" />
			
			        <select id="statusSelect" name="cocoStts" class="form-select" style="width: 150px;">
					    <option value="ST01" ${card.commonCodeVO.cocoStts == 'ST01' ? 'selected' : ''}>요청</option>
					    <option value="ST02" ${card.commonCodeVO.cocoStts == 'ST02' ? 'selected' : ''}>발급</option>
					    <option value="ST03" ${card.commonCodeVO.cocoStts == 'ST03' ? 'selected' : ''}>완료</option>
					    
					</select>

			    
    			</td>
            </tr>
       
        	 <tr>
            <th>학번</th>
            <td>${card.stuId}</td>
            
        </tr>	
                
            <tr>
                <td style="width: 20%;">이름</td>
                <td style="width: 50%;">${card.studentVO.nm }</td>
                
            </tr>
            <tr>
                <td>학년 / 학과</td>
                <td>2학년 / 컴퓨터 공학</td>
            </tr>
             <tr>
            <th>생년월일</th>
            <td colspan="2">
                ${fn:substring(fn:replace(card.studentVO.brdt, '-', ''), 0, 4)}년&nbsp;
                ${fn:substring(fn:replace(card.studentVO.brdt, '-', ''), 4, 6)}월&nbsp;
                ${fn:substring(fn:replace(card.studentVO.brdt, '-', ''), 6, 8)}일
            </td>
        </tr>
            <tr>
                <td>전화번호</td>
                <td>${card.studentVO.mbtlnum }</td>
            </tr>
            <tr>
                <td>이메일</td>
                <td>${card.studentVO.eml }</td>
            </tr>
            <tr>
                <td>요청일시</td>
                <td>${fn:split(card.stuCardDate, 'T')[0]} ${fn:split(card.stuCardDate, 'T')[1]}</td>
            </tr>
            <tr>
                <td>증명사진</td>
	            <td>
	                <c:if test="${not empty card.studentVO.proflPhoto}">
	                    <img src="data:image/png;base64,${card.studentVO.proflPhoto}" alt="증명사진" style="width: 150px; height: auto;" />
	                </c:if>
	                <c:if test="${empty card.studentVO.proflPhoto}">
	                    없음
	                </c:if>
	            </td>
            </tr>
        </tbody>
    </table>
    
     <div align="right">
        <a href="<c:url value='/studentCard'/>" class="btn btn-primary">목록</a>
        
    </div>
    </form>
    <script src="${pageContext.request.contextPath }/resources/js/studentCard/studentCardStatus.js"></script>
    