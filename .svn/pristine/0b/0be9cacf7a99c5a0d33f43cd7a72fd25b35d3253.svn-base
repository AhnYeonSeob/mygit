/**
 * 
 */
document.addEventListener("DOMContentLoaded", ()=>{
	// 주차 수정 버튼 클릭
	$(document).on('click', '.week-update-btn', function(){
		let $tr = $(this).parents('tr');
		$tr.find('button').toggle();
		let $td = $tr.find('.leweNm');
		$td.html(`<input class="form-control" type="text" value="${$td.text()}" data-origin="${$td.text()}"/>`);	
	});
	
	// 주차 수정 저장 버튼 클릭
	$(document).on('click', '.week-update-save-btn', function(){
		let $tr = $(this).parents('tr');
		let $td = $tr.find('.leweNm');
		let $input = $td.find('input');
		axios.put(`${cp.value}/lecture/${lectNo.value}/materials/${$tr.data("weekCd")}`
			, {leweNm: $input.val()})
		.then(resp=>{
			swal({
				title: "수정완료",
				text: "주차명이 성공적으로 수정되었습니다",
				icon: "success",
				button: "확인"
			});
			$td.text($input.val());
		}).catch(err=>{
			swal({
				title: "수정실패",
				text: err.response.data.message,
				icon: "error",
				button: "확인"
			});
			$td.text($input.data("origin"));
		});
		$tr.find('button').toggle();
	});
	
	// 주차 수정 취소 버튼 클릭
	$(document).on('click', '.week-update-cancel-btn', function(){
		let $tr = $(this).parents('tr');
		$tr.find('button').toggle();
		let $td = $tr.find('.leweNm');
		let $input = $td.find('input');
		$td.text($input.data("origin"));
	});
	
	// 주차 삭제 버튼 클릭
	$(document).on('click', '.week-delete-btn', function(){
		let $tr = $(this).parents('tr');
		swal({
			title: "정말로 삭제하시겠습니까?",
			text: "주차를 삭제하면 주차에 해당하는 차시까지 같이 삭제됩니다",
			icon: "warning",
			buttons: ["취소", "삭제"],
			dangerMode: true,
		}).then(btnVal=>{
			if(btnVal){
				axios.delete(`${cp.value}/lecture/${lectNo.value}/materials/${$tr.data("weekCd")}`)
				.then(resp=>{
					swal({
						title: "수정완료",
						text: "주차가 성공적으로 삭제되었습니다",
						icon: "success",
						button: "확인"
					});
					// 삭제 후 처리(주차 정보 삭제, 하위 차시 삭제, 차시 추가 버튼 삭제)
					$(`.weekCd[data-week-cd="${$tr.data('weekCd')}"]`).remove();
				}).catch(err=>{
					swal({
						title: "삭제실패",
						text: err.response.data.message,
						icon: "error",
						button: "확인"
					});
				})
			}
		});
	});
	
	$("#insertWeekModal").on('show.bs.modal', function(){
		// 주차 공통 코드 리스트 불러오기
		axios.get(`${cp.value}/commoncode/WEEK`)
		.then(({data})=>{
			$("#weekCd").empty();
			$("#weekCd").append('<option selected label="주차선택"/>');
			leweNm.value = "";
			data.forEach(v=>{
				if($(`.weekCd[data-week-cd="${v.cocoCd}"]`).length==0){
					$("#weekCd").append(`<option value="${v.cocoCd}" label="${v.cocoStts}">`);
				}
			});
		});
	});
	
	// 주차 추가 버튼 클릭
	$(document).on('click', '.week-insert-btn', function(){
		axios.post(`${cp.value}/lecture/${lectNo.value}/materials`
		, {
			weekCd: $('#weekCd').val(),
			leweNm: $('#leweNm').val()
		}).then(resp=>{
			swal({
				title: "추가완료",
				text: "주차가 성공적으로 추가되었습니다",
				icon: "success",
				button: "확인"
			});
		}).catch(err=>{
			swal({
				title: "추가실패",
				text: "주차 추가에 실패하였습니다\r\n잠시 후 다시 시도해 주세요",
				icon: "error",
				button: "확인"
			});
		});
	});
	
	// 차시 수정 버튼 클릭
	$(document).on('click', '.data-update-btn', function(){
		console.log(".data-update-btn");
	});
	
	// 차시 삭제 버튼 클릭
	$(document).on('click', '.data-delete-btn', function(){
		console.log(".data-delete-btn");
	});
});