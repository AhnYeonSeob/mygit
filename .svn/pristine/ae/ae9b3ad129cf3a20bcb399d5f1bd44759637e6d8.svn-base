<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/functions" prefix="fn"%>

<h2 class="text-left">과제</h2>
<input id="lectNo" type="hidden" value="${lectNo }">
<hr style="border: 2px solid blue;" />
<table class="table table-bordered" id="form-table" data-path="${pageContext.request.contextPath }" data-auth="${pageContext.request.userPrincipal.name }">
	<tr>
		<th>과제명</th>
		<td>${assignment.assigNm }</td>
	</tr>
	<tr>
		<th>배점</th>
		<td>${assignment.assigScore }점</td>
	</tr>
	<tr>
		<th>제출마감일</th>
		<td>${fn:substring(assignment.assigEd, 0, 4)}-${fn:substring(assignment.assigEd, 4, 6)}-${fn:substring(assignment.assigEd, 6, 8)}</td>
	</tr>
	<tr>
		<th>첨부파일</th>
		<td>
			<c:forEach items="${assignment.atchFile.fileDetails }" var="fd" varStatus="vs">
			<c:url value='/atch/${fd.atchFileId }/${fd.fileSn }' var="downUrl"/>
			<a href="${downUrl }">${fd.orignlFileNm }(${fd.fileFancysize })</a>
				${not vs.last ? '|' : ''}
			</c:forEach>
			<c:if test="${empty assignment.atchFile.fileDetails}">
			    첨부파일없음
			</c:if>

		</td>
	</tr>
	
	<tr>
		<th>피어리뷰여부</th>
		<td>${assignment.peerYn }</td>
	</tr>
	<tr>
		<td colspan="2">${assignment.assigNotes }</td>
	</tr>
</table>
	<p class="text-end">
		<!-- 교수인경우 해당 버튼 출력 -->
		<c:if test="${fn:substring(pageContext.request.userPrincipal.name, 4, 6) eq '30' }">
			<a href="<c:url value='/lecture/${lectNo}/assignment/${assignment.assigNo }/edit' />" class="btn btn-info">수정</a>
			<form action="<c:url value='/lecture/${lectNo}/assignment/${assignment.assigNo }/delete' />" method="post" style="display:inline;">
			    <button type="submit" class="btn btn-danger">삭제</button>
			</form>
		</c:if>
		<a href="<c:url value='/lecture/${lectNo}/assignment' />" class="btn btn-primary">목록</a>
	</p>
	<!-- 과제영역 끝 -->
	<!-- 제출과제영역 -->
	<h3 class="text-left">제출과제</h3>	
	<hr style="border: 2px solid blue;" />
	
	<c:forEach items="${assignment.assignmentsubmissionList }" var="submission">
		
		<div class="text-end">
			<input type="hidden" name="atchFileId" value="${assignment.atchFileId }">
			<c:if test="${fn:substring(pageContext.request.userPrincipal.name, 4, 6) eq '10'  and submission.assubYn eq 'N'}">
				<button class="btn btn-primary" id="submitBtn" 
				data-ed="${fn:substring(assignment.assigEd, 0, 4)}-${fn:substring(assignment.assigEd, 4, 6)}-${fn:substring(assignment.assigEd, 6, 8)}"
				data-assigno="${assignment.assigNo }"
				>제출
				</button>
			</c:if>
		</div>
	<c:if test="${submission.assubYn eq 'Y' and submission.stuId eq pageContext.request.userPrincipal.name }">


	<div id="resultArea">
	            <table class="table table-bordered">
	                <tr>
	                    <th class="text-center">학번</th>
	                    <td>${submission.stuId}</td>
	                </tr>
	                <tr>
	                    <th class="text-center">제출일시</th>
	                    <td> ${fn:substring(submission.assubDate, 0, 4)}-${fn:substring(submission.assubDate, 4, 6)}-${fn:substring(submission.assubDate, 6, 8)}</td>
	                </tr>
	                <tr>
	                	<th class="text-center">취득점수</th>
	                	<td>
	                	<c:if test="${not empty submission.assubScore }">
	                		${submission.assubScore }
	                	</c:if>
	                	<c:if test="${empty submission.assubScore }">
	                		채점 전입니다.
	                	</c:if>
	                	</td>
	                </tr>
	                <tr>
	                    <th class="text-center">첨부파일</th>
	                    <td>
	                    	<c:forEach items="${submission.atchFile.fileDetails }" var="sfd" varStatus="svs">
								<c:url value='/atch/${sfd.atchFileId }/${sfd.fileSn }' var="downUrl"/>
								<a href="${downUrl }">${sfd.orignlFileNm }(${sfd.fileFancysize })</a>
									${not svs.last ? '|' : ''}
							</c:forEach>
							<c:if test="${empty submission.atchFile.fileDetails}">
							    첨부파일없음
							</c:if>
	                    </td>
	                </tr>
	                <c:if test="${assignment.peerYn eq 'Y' }">
	                <tr>
	                	<th class="text-center">피어리뷰제출여부</th>
	                	<td>${submission.peerYn }</td>
	                </tr>
	                </c:if>
	                 <tr>
	                    <th class="text-center">제출 내용</th>
	                    <td>${submission.assubNotes}</td>
	                </tr>
	            </table>
	            <!-- 수정 버튼 -->
	            <div class="text-end">
	                <button class="btn btn-info" id="editSubmissionBtn"
	                data-id="${submission.stuId }"
	                data-assigno="${submission.assigNo }"
	                data-lectno="${submission.lectNo }"
	                >
	                수정</button>
	                <button class="btn btn-danger" id="delBtn"
	                data-id="${submission.stuId }"
	                data-assigno="${submission.assigNo }"
	                data-lectno="${submission.lectNo }"
	                >삭제</button>
	                <c:if test="${assignment.peerYn eq 'Y' and submission.peerYn eq 'N'}">
	                <button class="btn btn-primary" id="peerBtn"
	                data-id="${submission.stuId }"
	                data-assigno="${submission.assigNo }"
	                data-lectno="${submission.lectNo }"
	                >피어리뷰저장</button>
	                </c:if>
	            </div>
	
	</div>
			</c:if>
		</c:forEach>

<div id="submitFormArea"></div>

<!-- Bootstrap 모달 -->
<div class="modal fade" id="peerReviewModal" tabindex="-1" aria-labelledby="peerReviewModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="peerReviewModalLabel">피어리뷰 작성</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <!-- 모달 내부 내용이 JavaScript로 동적으로 생성됩니다 -->
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary" id="savePeerReviewBtn"
        data-selectedscore=""
        data-assigno=""
        >저장</button>
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">취소</button>
      </div>
    </div>
  </div>
</div>



<script src="${pageContext.request.contextPath }/resources/js/assignment/assignment.js"></script>