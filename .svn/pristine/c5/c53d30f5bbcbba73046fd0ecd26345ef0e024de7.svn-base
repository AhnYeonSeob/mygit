import {
	ClassicEditor,
	SimpleUploadAdapter,
	Bold,
	Italic,
	Underline,
	BlockQuote,
	Essentials,
	Heading,
	Image,
	ImageUpload,
	Link,
	List,
	MediaEmbed,
	Table,
	TableToolbar,
	FontSize,
	FontFamily,
	FontColor,
	Undo
} from '../../../resources/js/ckeditor5/ckeditor5.js';
document.addEventListener('DOMContentLoaded', function() {
	var contextPath = document.querySelector('#form-table').dataset['path'];
	var editorInstance;
	const csrfMetaTag = document.querySelector('meta[name="csrf-token"]');
	const csrfToken = csrfMetaTag ? csrfMetaTag.getAttribute('content') : null;
	ClassicEditor.create(document.querySelector('#editor'), {
		licenseKey: 'GPL'
		, plugins: [
			Essentials, Bold, Italic, Underline, Link, Image, ImageUpload,
			List, BlockQuote, Heading, MediaEmbed, Table, TableToolbar,
			FontSize, FontFamily, FontColor, Undo, SimpleUploadAdapter
		],
		toolbar: [
			'undo', 'redo', '|', 'bold', 'italic', 'underline', '|', 'link', 'imageUpload', '|',
			'bulletedList', 'numberedList', '|', 'blockquote', 'insertTable', '|',
			'fontSize', 'fontFamily', 'fontColor'
		]
		, language: 'ko'
		, simpleUpload: {
			uploadUrl: `${contextPath}/imageUpload`
			, headers: csrfToken ? { 'X-CSRF-TOKEN': csrfToken } : {}
		}
	})
	.then(editor => {
		editor.editing.view.change(writer=>{
            writer.setStyle('height', '400px', editor.editing.view.document.getRoot());
        });
		editorInstance = editor;
	})
	.catch(error => {
		console.error(error);
	});
	
	$('#insertForm').on('submit', function(e){
		e.preventDefault();
		axios.post(`${cp.value}/lecture/${lectNo.value}/inquiry/new`
			, new FormData($('#insertForm')[0]))
		.then(({data})=>{
			location.href = `${cp.value}/lecture/${lectNo.value}/inquiry/${data.libNo}`
		}).catch(err=>{
			swal({
				title: "등록실패",
				text: err.response.data.message,
				icon: "error",
				button: "확인"
			});
		});
	});
});