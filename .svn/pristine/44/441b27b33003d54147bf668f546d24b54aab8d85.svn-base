document.addEventListener("DOMContentLoaded", function () {
    const contextPath = document.getElementById("cp").value; // 컨텍스트 경로
    const sibNo = document.getElementById("sibNo").value; // 게시글 번호
    const ansInsertDiv = document.getElementById("ansInsertDiv"); // 댓글 작성 영역
    const ansZone = document.querySelector(".ansZone"); // "등록된 답변이 없습니다." 영역
    const ansInsertBtn = document.querySelector(".ansInsertBtn"); // 등록 버튼
    const ansCancelBtn = document.querySelector(".ansCancelBtn"); // 취소 버튼
    const ansSaveBtn = document.querySelector(".ansSaveBtn"); // 저장 버튼

    // 등록 버튼 클릭 시 작성 영역 표시 및 기존 요소 숨기기
    ansInsertBtn?.addEventListener("click", function () {
        ansZone.style.display = "none"; // "등록된 답변이 없습니다." 숨김
        ansInsertBtn.style.display = "none"; // 등록 버튼 숨김
        const listBtn = document.querySelector(".btn-primary"); // 목록 버튼 숨김
        listBtn.style.display = "none";

        ansInsertDiv.style.display = "block"; // 댓글 작성 영역 표시

        // 작성 영역 확장
        const formTable = document.getElementById("form-table");
        formTable.style.marginTop = "20px"; // 필요한 만큼 여백 추가
    });

    // 취소 버튼 클릭 시 기존 상태로 복원
    ansCancelBtn?.addEventListener("click", function () {
        ansInsertDiv.style.display = "none"; // 작성 영역 숨김
        ansZone.style.display = "block"; // "등록된 답변이 없습니다." 복원
        ansInsertBtn.style.display = "inline-block"; // 등록 버튼 복원
        const listBtn = document.querySelector(".btn-primary");
        listBtn.style.display = "inline-block"; // 목록 버튼 복원
		textarea.style.display = "none"; // 답변 작성 textarea 숨김
        saveCancelBtn.style.display = "none"; // 저장/취소 버튼 숨김
        dispAnswer.style.display = "block"; // 기존 답변 표시
        delUpBtn.style.display = "block"; // 수정/삭제 버튼 표시
    });

    // 저장 버튼 클릭 시 동작
    ansSaveBtn?.addEventListener("click", function () {
        const answerContent = document.getElementById("editor").value.trim();

        if (!answerContent) {
            swal("오류", "답변 내용을 입력하세요.", "error");
            return;
        }

        axios
            .post(`${contextPath}/answer/registerReply`, {
                sibNo: sibNo,
                sibAns: answerContent
            })
            .then(response => {
                if (response.data === "success") {
                    swal("성공", "답변이 등록되었습니다.", "success").then(() => {
                        location.reload(); // 페이지 새로고침
                    });
                } else {
                    swal("실패", "답변 등록에 실패했습니다.", "error");
                }
            })
여
            .catch(error => {
                console.error(error);
                swal("오류", "서버와 통신 중 오류가 발생했습니다.", "error");
            });
    });
});
