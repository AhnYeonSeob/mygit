<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/functions" prefix="fn"%>
<%@ taglib uri="http://www.springframework.org/tags/form" prefix="form"%>
<%@ taglib uri="http://www.springframework.org/security/tags" prefix="security"%>
<input type="hidden" id="cp" value="${pageContext.request.contextPath }"/>
<form:form modelAttribute="condition" name="searchForm" method="get">
	<input type="hidden" id="page" name="page"/>
	<input type="hidden" id="show" name="show" value="${param.show }"/>
	<div class="collapse ${param.show eq 'Y' ? 'show' : '' }" id="search" style="position: relative;">
		<div id="detailConditionDiv" class="mb-3">
			<security:authorize access="!hasRole('STUDENT')">
				<div class="row g-3 mb-3">
					<div class="col">
						<label for="studentVO.nm" class="form-label">이름</label>
						<form:input path="studentVO.nm" cssClass="form-control"/>
					</div>
					<div class="col">
						<label for="stuId" class="form-label">학번</label>
						<form:input path="stuId" cssClass="form-control"/>
					</div>
					<div class="col">
						<label for="studentVO.deptCd" class="form-label">학과</label>
						<form:select path="studentVO.deptCd" cssClass="form-select">
							<option value="" label="선택안함"/>
							<form:options items="${departmentList }" itemLabel="deptNm" itemValue="deptNo" />
						</form:select>
					</div>
				</div>
			</security:authorize>
			<div class="row g-3 mb-3">
				<div class="col">
					<label for="semstrNo" class="form-label">신청학기</label>
					<form:select path="semstrNo" cssClass="form-select">
						<option value="" label="선택안함"/>
						<form:options items="${semesterList }" itemLabel="label" itemValue="semstrNo" />
					</form:select>
				</div>
				<div class="col">
					<label for="streCateCd" class="form-label">신청학적</label>
					<form:select path="streCateCd" cssClass="form-select">
						<option value="" label="선택안함"/>
						<form:options items="${streCateCodeList }" itemLabel="cocoStts" itemValue="cocoCd" />
					</form:select>
				</div>
				<div class="col">
					<label for="streStatusCd" class="form-label">결재상태</label>
					<form:select path="streStatusCd" cssClass="form-select">
						<option value="" label="선택안함"/>
						<form:options items="${streStatusCodeList }" itemLabel="cocoStts" itemValue="cocoCd"/>
					</form:select>
				</div>
			</div>
		</div>
	</div>
</form:form>
<button class="btn btn-primary float-end mb-3" data-bs-toggle="collapse" data-bs-target="#search, #searchSubmit" 
		aria-expanded="false" aria-controls="search"><i class="bi bi-search"></i></button>
<div class="float-end me-2 fade-transition ${param.show eq 'Y' ? 'visible' : 'hidden' }" id="searchDiv">
	<button class="btn btn-secondary me-1" id="searchBtn">검색</button>
	<button class="btn btn-warning" id="resetBtn"><i class="bi bi-arrow-clockwise"></i></button>
</div>
<table class="table table-bordered table-primary table-hover">
	<colgroup>
		<col width="50px">
		<col width="130px">
		<col width="120px">
		<col width="150px">
		<col width="130px">
		<col width="90px">
		<col width="180px">
	</colgroup>
	<thead>
		<tr class="text-center align-middle">
			<th>순번</th>
			<th>학번</th>
			<th>이름</th>
			<th>학과</th>
			<th>신청학기</th>
			<th>신청학적</th>
			<th>결재상태</th>
		</tr>
	</thead>
	<tbody class="table-light text-center">
		<c:if test="${stuRecList.size() eq 0 }">
			<tr><td colspan="7">조회된 내용이 없습니다</td></tr>
		</c:if>
		<c:forEach items="${stuRecList }" var="stuRec">
			<tr onclick="fnDetail(this);" data-stre-issu-no="${stuRec.streIssuNo }" style="cursor: pointer;">
				<td>${stuRec.rnum }</td>
				<td>${stuRec.stuId }</td>
				<td>${stuRec.studentVO.nm }</td>
				<td>${stuRec.studentVO.departmentVO.deptNm }</td>
				<td>${stuRec.semesterVO.label }</td>
				<td data-stre-cate-cd="${stuRec.streCateCd }">${stuRec.streCateCodeVO.cocoStts }</td>
				<td data-stre-status-cd="${stuRec.streStatusCd }">${stuRec.streStatusCodeVO.cocoStts }</td>
			</tr>
		</c:forEach>
	</tbody>
	<tfoot>
		<tr>
			<td colspan="7">
				<div class="d-flex justify-content-between align-items-center" style="position: relative; z-index: 0">
					<div class="mx-auto">
						${pagingHTML}
					</div>
					<security:authorize access="hasRole('STUDENT')">
						<div>
							<button class="btn btn-primary" style="position: absolute; right: 0px; top: 0px;"
									data-bs-toggle="modal" data-bs-target="#insertModal">등록</button>
						</div>
					</security:authorize>
				</div>
			</td>
		</tr>
	</tfoot>
</table>
<security:authorize access="hasRole('STUDENT')">
	<!-- 학적변동신청 모달 -->
	<div class="modal fade" id="insertModal" tabindex="-1" aria-labelledby="insertModalLabel" aria-hidden="true">
	  <div class="modal-dialog modal-dialog-centered">
	    <div class="modal-content">
	      <div class="modal-header">
	        <h1 class="modal-title fs-5" id="insertModalLabel">학적 변동 신청</h1>
	      </div>
	      <div class="modal-body">
	      	<form name="insertForm">
		      	<div class="row g-3 mb-3">
					<div class="col">
						<label for="semstrNo" class="form-label">신청학기</label>
						<select name="semstrNo" class="form-select">
							<option value="" label="학기를 선택하세요"/>
							<c:forEach items="${semesterList }" var="semester">
								<option value="${semester.semstrNo }" label="${semester.label }"/>
							</c:forEach>
						</select>
					</div>
					<div class="col">
						<label for="streCateCd" class="form-label">신청학적</label>
						<select name="streCateCd" class="form-select" onchange="fnStreCateChange(this);">
							<option value="" label="학적을 선택하세요"/>
							<c:forEach items="${streCateCodeList }" var="streCateCode">
								<c:if test="${streCateCode.cocoCd ne 'SR04'}">
									<option value="${streCateCode.cocoCd }" label="${streCateCode.cocoStts }"/>
								</c:if>
							</c:forEach>
						</select>
					</div>
					<div>
						<label for="streResSel" class="form-label">신청사유</label>
						<select class="form-select mb-2" id="streResSel" onchange="fnStreResSelChange(this);">
							<option class="SR01 SR02 SR03" label="직접입력" value=""/>
							<option class="SR01" style="display: none;" value="일반 휴학" label="일반 휴학"/>
							<option class="SR01" style="display: none;" value="군입대 휴학" label="군입대 휴학"/>
							<option class="SR01" style="display: none;" value="출산 휴학" label="출산 휴학"/>
							<option class="SR02" style="display: none;" value="일반 복학" label="일반 복학"/>
							<option class="SR02" style="display: none;" value="군제대 복학" label="군제대 복학"/>
							<option class="SR02" style="display: none;" value="출산 복학" label="출산 복학"/>
							<option class="SR03" style="display: none;" value="취업" label="취업"/>
							<option class="SR03" style="display: none;" value="창업" label="창업"/>
							<option class="SR03" style="display: none;" value="타대학 신입학" label="타대학 신입학"/>
							<option class="SR03" style="display: none;" value="타대학 편입" label="타대학 편입"/>
							<option class="SR03" style="display: none;" value="가계 곤란" label="가계 곤란"/>
						</select>
						<textarea name="streRes" class="form-control" rows="5"></textarea>
					</div>
					<div>
						<label for="streRes" class="form-label">첨부파일</label>
						<input type="file" class="form-control"/>
					</div>
				</div>
			</form>
	      </div>
	      <div class="modal-footer">
	        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">닫기</button>
	      </div>
	    </div>
	  </div>
	</div>
</security:authorize>
<script src="${pageContext.request.contextPath }/resources/js/student/studentRecordsList.js"></script>

























