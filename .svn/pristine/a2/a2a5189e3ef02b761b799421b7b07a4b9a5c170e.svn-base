           <%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c"%>
<%@ taglib uri="http://www.springframework.org/tags/form" prefix="form"%>
<%@ taglib uri="http://www.springframework.org/tags" prefix="spring"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/functions" prefix="fn"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/fmt" prefix="fmt"%>
<%@ taglib uri="http://www.springframework.org/security/tags" prefix="security"%>

<security:authentication property="principal.username" var="id"/>
<input type="hidden" value="${my.id }" id="id" />
<script>
    const contextPath = "${pageContext.request.contextPath}/";
</script>

<style>

.profile .profile-card img {
  max-width: 120px;
}

.profile .profile-card h2 {
  font-size: 24px;
  font-weight: 700;
  color: #2c384e;
  margin: 10px 0 0 0;
}

.profile .profile-card h3 {
  font-size: 18px;
}

.profile .profile-card .social-links a {
  font-size: 20px;
  display: inline-block;
  color: rgba(1, 41, 112, 0.5);
  line-height: 0;
  margin-right: 10px;
  transition: 0.3s;
}

.profile .profile-card .social-links a:hover {
  color: #012970;
}

.profile .profile-overview .row {
  margin-bottom: 20px;
  font-size: 15px;
}

.profile .profile-overview .card-title {
  color: #012970;
}

.profile .profile-overview .label {
  font-weight: 600;
  color: rgba(1, 41, 112, 0.6);
}

.profile .profile-edit label {
  font-weight: 600;
  color: rgba(1, 41, 112, 0.6);
}

.profile .profile-edit img {
  max-width: 120px;
}

</style>
           
           <h4>개인정보 수정</h4>
        
          <form method="post" action="${pageContext.request.contextPath}/mypage/${my.id}/UpdateMyPage" onsubmit="return validatePasswords()">
            <!-- 프로필 사진 -->
            <div class="row mb-3">
              <label for="proflPhoto" class="col-md-4 col-lg-3 col-form-label">프로필 사진</label>
              <div class="col-md-8 col-lg-9">
              
              <c:choose>
	            <c:when test="${not empty my.proflPhoto}">
	              <img src="data:image/jpeg;base64,${fn:escapeXml(my.proflPhoto)}" alt="Profile Photo" style="width: 100px; height: 100px; object-fit: cover;"/>
	            </c:when>
	            <c:otherwise>
	              <img src="${pageContext.request.contextPath}/resources/NiceAdmin/assets/img/default-profile.jpg" alt="Default Profile Photo"  alt="Profile Photo" style="width: 100px; height: 100px; object-fit: cover;" />
	            </c:otherwise>
	          </c:choose>
	          
                
                <div class="pt-2">
                  <a href="#" class="btn btn-primary btn-sm" title="새 프로필 업로드"><i class="bi bi-upload"></i></a>
                  <a href="#" class="btn btn-danger btn-sm" title="프로필 삭제"><i class="bi bi-trash"></i></a>
                </div>
              </div>
            </div>

            <div class="row mb-3">
              <label for="nm" class="col-md-4 col-lg-3 col-form-label">이름</label>
              <div class="col-md-8 col-lg-9">
                <input name="nm" type="text" class="form-control" id="nm" value="${my.nm }" readonly>
              </div>
            </div>
            
            <div class="row mb-3">
              <label for="id" class="col-md-4 col-lg-3 col-form-label">학번</label>
              <div class="col-md-8 col-lg-9">
                <input name="id" type="text" class="form-control" id="id" value="${my.id }" readonly>
              </div>
            </div>

             <!-- 비밀번호 -->
		    <div class="row mb-3">
		        <label for="pswd" class="col-md-4 col-lg-3 col-form-label">비밀번호</label>
		        <div class="col-md-8 col-lg-9">
		            <input name="pswd" type="password" class="form-control" id="pswd" required>
		        </div>
		    </div>
		
		    <!-- 비밀번호 확인 -->
		    <div class="row mb-3">
		        <label for="confirmPswd" class="col-md-4 col-lg-3 col-form-label">비밀번호 확인</label>
		        <div class="col-md-8 col-lg-9">
		            <input name="confirmPswd" type="password" class="form-control" id="confirmPswd" required>
		        </div>
		        <c:if test="${not empty successMessage}">
				    <div class="alert alert-success">${successMessage}</div>
				</c:if>
				<c:if test="${not empty errorMessage}">
				    <div class="alert alert-danger">${errorMessage}</div>
				</c:if>
		    </div>
            <!-- 전화번호 -->
            <div class="row mb-3">
              <label for="mbtlnum" class="col-md-4 col-lg-3 col-form-label">전화번호</label>
              <div class="col-md-8 col-lg-9">
                <input name="mbtlnum" type="text" class="form-control" id="mbtlnum" value="${my.mbtlnum }">
              </div>
            </div>
            <!-- 생년월일 -->
            <div class="row mb-3">
              <label for="brdt" class="col-md-4 col-lg-3 col-form-label">생년월일</label>
              <div class="col-md-8 col-lg-9">
                <input name="brdt" type="text" class="form-control" id="brdt" value="${my.brdt }">
              </div>
            </div>
            <!-- 이메일 -->
            <div class="row mb-3">
              <label for="eml" class="col-md-4 col-lg-3 col-form-label">이메일</label>
              <div class="col-md-8 col-lg-9">
                <input name="eml" type="text" class="form-control" id="eml" value="${my.eml }">
              </div>
            </div>

           <!-- 우편번호 -->
				<div class="row mb-3">
				  <label for="zip" class="col-md-4 col-lg-3 col-form-label">우편번호</label>
				  <div class="col-md-8 col-lg-9 d-flex align-items-center">
				    <input name="zip" type="text" class="form-control me-2" id="zip" style="width: 150px;" value="${my.zip }">
				  
				  </div>
				</div>



            <!-- 주소 -->
            <div class="row mb-3">
              <label for="rdnmadr" class="col-md-4 col-lg-3 col-form-label">주소</label>
              <div class="col-md-8 col-lg-9">
                <input name="rdnmadr" type="text" class="form-control" id="rdnmadr"  value="${my.rdnmadr }">
              </div>
            </div>

            <!-- 상세주소 -->
            <div class="row mb-3">
              <label for="daddr" class="col-md-4 col-lg-3 col-form-label">상세주소</label>
              <div class="col-md-8 col-lg-9">
                <input name="daddr" type="text" class="form-control" id="daddr"  value="${my.daddr }">
              </div>
            </div>

            <!-- 수신 여부 -->
            <div class="row mb-3">
              <label class="col-md-4 col-lg-3 col-form-label">수신 여부</label>
              <div class="col-md-8 col-lg-9">
                <div class="form-check form-check-inline">
                  <input class="form-check-input" type="checkbox" id="emailSubscription" checked>
                  <label class="form-check-label" for="emailSubscription">이메일 수신</label>
                </div>
                <div class="form-check form-check-inline">
                  <input class="form-check-input" type="checkbox" id="smsSubscription">
                  <label class="form-check-label" for="smsSubscription">SMS 수신</label>
                </div>
              </div>
            </div>

          
			  <div class="text-center">
			    <button type="submit" class="btn btn-primary">취소</button>
			    <button type="submit" class="btn btn-primary">저장</button>
			   

			  
			  </div>
		
          
		
              </form>
              
 <script>
 document.querySelector("form").addEventListener("submit", function (e) {
	    const password = document.getElementById("pswd").value;
	    const confirmPassword = document.getElementById("confirmPswd").value;

	    if (password !== confirmPassword) {
	        e.preventDefault(); // 폼 제출 중단
	        swal("비밀번호 불일치", "비밀번호가 일치하지 않습니다.", "warning");
	    }
	});

</script>
      