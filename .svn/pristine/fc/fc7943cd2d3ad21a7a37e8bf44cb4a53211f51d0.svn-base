
document.addEventListener('DOMContentLoaded', function() {
    // "조회" 버튼을 클릭할 때마다 비동기 요청을 보내도록 설정
   	console.log("되냐구")
    const fetchButtons = document.querySelectorAll('.fetch-attendance-btn');
	fetchButtons.forEach(button => {
        button.addEventListener('click', function() {
            const lectOrder = this.getAttribute('data-lect-order'); // 강의차수
            const weekCd = this.getAttribute('data-week-cd'); // 주차 코드
            
            // 비동기 함수 호출
            fetchAttendanceData(lectOrder, weekCd); // 중괄호에 맞는 위치
        });
    });  // forEach 끝

});  // DOMContentLoaded 끝

// 비동기 데이터 요청 함수
function fetchAttendanceData(lectOrder, weekCd) {
    // 해당 URL을 서버 API와 맞게 설정
    fetch(`/attendance/${weekCd}/${lectOrder}`) // 서버에 비동기 요청
        .then(response => response.json()) // 응답을 JSON으로 파싱
        .then(data => {
            // 응답 데이터를 HTML 테이블에 표시
            const attendanceTableBody = document.getElementById('attendanceTableBody');
            attendanceTableBody.innerHTML = ''; // 기존 데이터 초기화

            if (data.length > 0) {
                // 출결 데이터가 있으면 각 학생 정보 테이블에 추가
                data.forEach(attendance => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${attendance.stuId}</td>
                        <td>${attendance.personVO.nm}</td>
                        <td>${attendance.classRoomVO.croomNm}</td>
                        <td>${attendance.commonCodeVO.cocoStts}</td>
                    `;
                    attendanceTableBody.appendChild(row);
                });
            } else {
                // 출결 데이터가 없을 경우
                const row = document.createElement('tr');
                row.innerHTML = '<td colspan="4">출결 데이터가 없습니다.</td>';
                attendanceTableBody.appendChild(row);
            }
        })
        .catch(error => console.error('출결 데이터 요청 오류:', error)); // 오류 처리
}  // fetchAttendanceData 끝

