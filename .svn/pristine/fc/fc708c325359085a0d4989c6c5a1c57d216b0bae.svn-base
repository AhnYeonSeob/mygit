document.addEventListener("DOMContentLoaded", () => {
	
	const contextPath = document.getElementById('contextPath').value;
	const lectNo = document.getElementById('lectNo').value;
	const mainBoardCount = document.getElementById('mainBoardCount').value; 
	//const cnbNo = document.getElementById('cnbNo').value;
	
	console.log("contextPath : ", contextPath)
	console.log("lectNo : ", lectNo)
	console.log("mainBoardCount : ", mainBoardCount)
	
	if (mainBoardCount === '3') {
	    // 체크박스 클릭 이벤트 리스너 추가
	    document.getElementById('boardMainYn').addEventListener('click', function(event) {
	        this.checked = false;  // 체크 해제
	        swal({
	            icon: 'warning',
	            title: '초과',
	            text: '메인 공지사항이 한도를 초과했습니다. (3개)'
	        });
	        // 클릭된 체크박스의 상태를 원래대로 유지하지 않도록 클릭을 취소
	        event.preventDefault();  // 클릭 이벤트 취소
	    });
	}

	document.getElementById("submitBtn").addEventListener("click", function(event) {
	    // 클릭 시 동작을 처리
	    event.preventDefault(); // 기본 동작을 막고
		
		let fileForm = document.forms.fileForm; // 업로드 한 파일
		let formData = new FormData(fileForm);
		
		// 얘는 안들어갈수도 있으니까 직접 넣어줘야함
		let boardContent = editorInstance[0].getData(); // 게시글 내용
		formData.set('cnbNotes', boardContent); // 'append'는 중복 데이터가 들어갈수도 있으니까 'set'으로 
		
		let cnbMainYn = '';
		
		// 공지사항 고정 데이터
		if (document.getElementById('boardMainYn').checked) {
			cnbMainYn = 'Y';
		} else {
		    cnbMainYn = 'N';
		}
		formData.set('cnbMainYn', cnbMainYn); 
		
		for(let k of formData){
			console.log(k)
		}
		
		console.log(formData.get('cnbNm'));
		
		fetch(`${contextPath}/lecture/${lectNo}/board/insert`, {
		    method: 'POST',
		    body: formData
		})
		.then(response => response.json())  // JSON 형식으로 파싱
		.then(data => {
		    console.log("Success:", data);
			if (!formData.get('cnbNm') || formData.get('cnbNm').trim() === "") {
		        swal("오류", "제목을 입력해주세요.", "error");
		        return;
		    }
			if (!formData.get('cnbNotes') || formData.get('cnbNotes').trim() === "") {
		        swal("오류", "내용을 입력해주세요.", "error");
		        return;
		    }
			if (!formData.get('uploadFiles').name) {
		        swal("오류", "첨부파일을 넣어주세요.", "error");
		        return;
		    }
		    swal("성공", "강의 공지사항 등록 완료.", "success")
		    .then(() => {
		        window.location.href = `${contextPath}/lecture/${lectNo}/board`;
		    });
		})
		.catch(error => {
		    console.error('Error:', error);
		    swal("오류", "데이터 전송 중 문제가 발생했습니다. 다시 시도해주세요.", "error");
		});

	});


}); 